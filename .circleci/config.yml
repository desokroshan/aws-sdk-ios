# iOS CircleCI 2.0 configuration file
#
# Check https://circleci.com/docs/2.0/ios-migrating-from-1-2/ for more details
#

version: 2
jobs:
  build:
    # Specify the Xcode version to use
    macos:
      xcode: "9.2.0"
    steps:
      - checkout
      - run:
          name: Clone the samples repository
          command: |
            git clone https://github.com/awslabs/aws-sdk-ios-samples.git
            currentFolder=$(pwd)
            cd aws-sdk-ios-samples
            git checkout uiTest
            cd S3TransferUtility-Sample/Swift/
      - run:
          name: Copy awsconfiguration.json file
          command: |
            pwd
            echo ${awsconfiguration} | base64 --decode >> S3BackgroundTransferSampleSwift/awsconfiguration.json
      - run:
          name: Install Pods
          command: |
            pod install
      - run:
          name: runInstrumentationTest
          command: |
            xcodebuild -workspace S3TransferUtilitySampleSwift.xcworkspace -scheme "S3TransferUtilitySampleSwiftUITests" -destination 'platform=iOS Simulator,name=iPhone 8 Plus,OS=11.2' test
      - run:
          name: Cleanup
          command: |
            cd $currentFolder
            rm -rf aws-sdk-ios-samples
workflows:
  version: 2

  build_and_test:
    jobs:
      - build